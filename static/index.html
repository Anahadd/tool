<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impressions Tool - Admin</title>
    <link rel="stylesheet" href="/static/styles.css?v=12">
    <link rel="stylesheet" href="/static/dark-theme.css?v=13">
    <!-- Firebase SDK -->
    <script type="module" src="/static/firebase-init.js?v=12"></script>
</head>
<body>
    <!-- Kalshi Logo -->
    <img src="/static/kalshi-logo.svg" alt="Kalshi" class="kalshi-logo">
    <!-- Auth Page -->
    <div id="authPage" class="auth-page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h1>Impressions Tool</h1>
                <p class="subtitle">TikTok, YouTube & Instagram Analytics</p>
                
                <button id="googleSignInBtn" class="btn btn-google btn-large">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.64 9.20443C17.64 8.56625 17.5827 7.95262 17.4764 7.36353H9V10.8449H13.8436C13.635 11.9699 13.0009 12.9231 12.0477 13.5613V15.8194H14.9564C16.6582 14.2526 17.64 11.9453 17.64 9.20443Z" fill="#4285F4"/>
                        <path d="M9 18C11.43 18 13.4673 17.1941 14.9564 15.8195L12.0477 13.5613C11.2418 14.1013 10.2109 14.4204 9 14.4204C6.65591 14.4204 4.67182 12.8372 3.96409 10.71H0.957275V13.0418C2.43818 15.9831 5.48182 18 9 18Z" fill="#34A853"/>
                        <path d="M3.96409 10.71C3.78409 10.17 3.68182 9.59318 3.68182 9C3.68182 8.40682 3.78409 7.82999 3.96409 7.28999V4.95818H0.957275C0.347727 6.17318 0 7.54772 0 9C0 10.4523 0.347727 11.8268 0.957275 13.0418L3.96409 10.71Z" fill="#FBBC05"/>
                        <path d="M9 3.57955C10.3214 3.57955 11.5077 4.03364 12.4405 4.92545L15.0218 2.34409C13.4632 0.891818 11.4259 0 9 0C5.48182 0 2.43818 2.01682 0.957275 4.95818L3.96409 7.29C4.67182 5.16273 6.65591 3.57955 9 3.57955Z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>
                
                <p class="auth-footer-text">
                    By signing in, you agree to our Terms of Service
                </p>
            </div>
        </div>
    </div>

    <!-- Service Account Info Page (after first login) -->
    <div id="credentialsSetupPage" class="auth-page hidden">
        <div class="auth-container" style="max-width: 700px;">
            <div class="auth-card">
                <h1>ðŸ“‹ Important: Share Your Google Sheet</h1>
                <p class="subtitle">To use this tool, share your Google Sheet with our service account</p>
                
                <div style="background: #f0f9ff; border: 2px solid #3b82f6; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
                    <h3 style="margin: 0 0 1rem 0; color: #1e40af; font-size: 1.1rem;">Service Account Email:</h3>
                    <div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #ddd; font-family: monospace; font-size: 0.9rem; word-break: break-all; margin-bottom: 1rem;">
                        kalshitoolsalman@gen-lang-client-0071269503.iam.gserviceaccount.com
                    </div>
                    <button id="copyEmailBtn" class="btn btn-secondary" style="width: 100%;">
                        ðŸ“‹ Copy Email to Clipboard
                    </button>
                </div>
                
                <div style="background: #fefce8; border-left: 4px solid #eab308; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #854d0e;">How to Share:</h4>
                    <ol style="margin: 0; padding-left: 1.5rem; color: #713f12;">
                        <li>Open your Google Sheet</li>
                        <li>Click the <strong>"Share"</strong> button (top right)</li>
                        <li>Paste the email above</li>
                        <li>Set permission to <strong>"Editor"</strong></li>
                        <li>Click <strong>"Send"</strong></li>
                    </ol>
                </div>
                
                <button id="continueBtn" class="btn btn-primary btn-large" style="margin-top: 1.5rem; width: 100%;">
                    I've Shared My Sheet - Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard hidden">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search..." class="search-input">
            </div>
            <button id="addSheetBtn" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Google Sheets
            </button>
        </div>

        <!-- Sheets Table -->
        <div class="sheets-container">
            <div class="table-actions" id="tableActions" style="display: none;">
                <button id="deleteSelectedBtn" class="btn btn-danger" onclick="deleteSelected()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete Selected
                </button>
            </div>
            <table class="sheets-table">
                <thead>
                    <tr>
                        <th class="checkbox-col"><input type="checkbox" id="selectAll"></th>
                        <th class="name-col">NAME</th>
                        <th class="description-col">DESCRIPTION</th>
                        <th class="status-col">STATUS</th>
                        <th class="action-col">ACTION</th>
                    </tr>
                </thead>
                <tbody id="sheetsTableBody">
                    <!-- Sheets will be dynamically added here -->
                </tbody>
            </table>
        </div>

        <!-- Bottom Bar -->
        <div class="bottom-bar">
            <button id="settingsBtn" class="btn btn-secondary">
                Settings
            </button>
            <button id="logoutBtn" class="btn btn-text">Logout</button>
        </div>
    </div>

    <!-- Add/Edit Sheet Modal -->
    <div id="sheetModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Google Sheet</h2>
                <button id="closeSheetModalBtn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="sheetName" placeholder="Daily Runs" class="input-field">
                </div>
                <div class="form-group">
                    <label>Google Sheet URL</label>
                    <input type="text" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." class="input-field">
                </div>
                <div class="form-group">
                    <label>Worksheet Name</label>
                    <input type="text" id="sheetWorksheet" value="Sheet1" class="input-field">
                </div>
                <div class="form-group">
                    <label>Description (Optional)</label>
                    <input type="text" id="sheetDescription" placeholder="Add description here" class="input-field">
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelSheetBtn" class="btn btn-secondary">Cancel</button>
                <button id="saveSheetBtn" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings & Info</h2>
                <button id="closeSettingsModalBtn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <h3>ðŸ“‹ Service Account Email</h3>
                <p style="color: #6b7280; margin-bottom: 1rem;">Share your Google Sheets with this email (as Editor) to use the tool:</p>
                
                <div style="background: #f0f9ff; border: 2px solid #3b82f6; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                    <div style="background: white; padding: 0.75rem; border-radius: 6px; border: 1px solid #ddd; font-family: monospace; font-size: 0.85rem; word-break: break-all; margin-bottom: 0.75rem;">
                        kalshitoolsalman@gen-lang-client-0071269503.iam.gserviceaccount.com
                    </div>
                    <button id="copyEmailSettingsBtn" class="btn btn-secondary" style="width: 100%;">
                        ðŸ“‹ Copy Email
                    </button>
                </div>
                
                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; margin-top: 1.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #374151; font-size: 0.95rem;">How to Share Your Sheet:</h4>
                    <ol style="margin: 0; padding-left: 1.5rem; color: #6b7280; font-size: 0.9rem; line-height: 1.6;">
                        <li>Open your Google Sheet</li>
                        <li>Click "Share" (top right)</li>
                        <li>Paste the email above</li>
                        <li>Select "Editor" permission</li>
                        <li>Click "Send"</li>
                    </ol>
                </div>
                
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb; text-align: center;">
                    <p style="color: #9ca3af; font-size: 0.85rem;">
                        No credential uploads needed â€¢ Works for all users
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Toast -->
    <div id="statusToast" class="status-toast hidden">
        <span id="toastIcon"></span>
        <span id="toastMessage"></span>
    </div>

    <script type="module" src="/static/script.js?v=12"></script>
</body>
</html>
